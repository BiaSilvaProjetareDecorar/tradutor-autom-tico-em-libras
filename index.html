<!DOCTYPE html>
<html>
<head>
    <title>Tradutor Automático de Texto para Libras - Protótipo Garantido</title>
</head>
<body>

    <h1>Tradutor Automático de Texto para Libras</h1>
    <p>Digite a frase em Português e clique em Traduzir. A adaptação linguística será feita pelas suas regras, e o resultado abrirá em uma nova aba.</p>

    <textarea id="texto-original" rows="4" cols="50" style="width: 100%; font-size: 16px; margin-bottom: 10px;" placeholder="Digite aqui a frase em Português (Ex: Eu comprei uma casa bonita ontem.)"></textarea>

    <div id="saida-texto" style="border: 1px solid #ccc; padding: 10px; min-height: 50px; margin-bottom: 20px; background-color: #f0f0f0;">
        A tradução adaptada aparecerá aqui!
    </div>

    <button id="traduzir-btn" style="font-size: 18px; padding: 10px; background-color: #007bff; color: white;">Traduzir para Libras</button>
    
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/a006c000003Nf07/plugin.js" async defer></script>


    <script id="codigo-traducao">
        const textoOriginalEl = document.getElementById('texto-original');
        const saidaTextoEl = document.getElementById('saida-texto');
        const traduzirBtn = document.getElementById('traduzir-btn');

        // AÇÃO PRINCIPAL AO CLICAR EM TRADUZIR
        traduzirBtn.addEventListener('click', () => {
            const textoOriginal = textoOriginalEl.value.trim();
            
            if (textoOriginal.length === 0) {
                saidaTextoEl.innerText = "Por favor, digite uma frase para traduzir.";
                return;
            }

            // CHAMA A FUNÇÃO DE REGRAS E ADAPTAÇÃO
            const textoCorrigido = aplicarRegrasDeLibras(textoOriginal);
            
            saidaTextoEl.innerHTML = `
                <strong>Original:</strong> ${textoOriginal}<br>
                <strong>Tradução Adaptada:</strong> ${textoCorrigido}
            `;
            
            // JOGA O TEXTO CORRIGIDO NO VLIBRAS (SOLUÇÃO DE REDIRECIONAMENTO GARANTIDA)
            const linkVLibras = `https://www.vlibras.gov.br/translate/#text=${encodeURIComponent(textoCorrigido)}`;

            // Abre a tradução em uma nova aba para o usuário ver o avatar funcionando
            window.open(linkVLibras, '_blank');
            
            saidaTextoEl.innerHTML += `<br><em>A tradução completa abriu em uma nova aba para visualização do avatar!</em>`;
        });
        
        // ----------------------------------------------------------------
        // *** FASE 3: O CÉREBRO - FUNÇÃO DE REGRAS DE ADAPTAÇÃO PARA LIBRAS (O foco principal) ***
        // ----------------------------------------------------------------
        function aplicarRegrasDeLibras(textoOriginal) {
            // 1. Limpeza Inicial
            let textoCorrigido = textoOriginal.toLowerCase();

            // 2. CORREÇÃO E SUBSTITUIÇÃO LINGUÍSTICA (Priorizando a Glosa da Libras)
            textoCorrigido = textoCorrigido.replace(/\btá bom\b/g, 'ok');
            textoCorrigido = textoCorrigido.replace(/\ba gente\b/g, 'nós');
            textoCorrigido = textoCorrigido.replace(/\bmeu\b/g, 'eu');
            textoCorrigido = textoCorrigido.replace(/\bminha\b/g, 'eu');
            
            // Correção de erros de transcrição comuns
            textoCorrigido = textoCorrigido.replace(/\bsapo\b/g, 'saber'); 
            textoCorrigido = textoCorrigido.replace(/\bque a\b/g, ''); 
            
            // **REGRAS PARA SIMPLIFICAÇÃO DE VERBOS E TEMPO**
            textoCorrigido = textoCorrigido.replace(/\bcomprei\b/g, 'comprar'); 
            textoCorrigido = textoCorrigido.replace(/\bfui\b/g, 'ir');         
            
            // 3. REGRAS DE TEMPO/NEGAÇÃO (Para ordenar como na Libras)
            
            // Mover Advérbios de Tempo para o INÍCIO
            if (textoCorrigido.includes('amanhã')) {
                textoCorrigido = textoCorrigido.replace('amanhã', '').trim();
                textoCorrigido = 'amanhã ' + textoCorrigido;
            }
            if (textoCorrigido.includes('ontem')) {
                textoCorrigido = textoCorrigido.replace('ontem', '').trim();
                textoCorrigido = 'ontem ' + textoCorrigido;
            }
            
            // Mover a negação 'não' para o FINAL da frase
            if (textoCorrigido.includes(' não ')) {
                textoCorrigido = textoCorrigido.replace(' não ', ' ');
                textoCorrigido = textoCorrigido.trim() + ' NÃO';
            }

            // 4. REMOÇÃO FINAL
            // Artigos/Preposições desnecessárias
            textoCorrigido = textoCorrigido.replace(/\b(o|a|os|as|um|uma|uns|umas|de|da|do|e|em)\b/g, '').trim();

            // Formatação final
            textoCorrigido = textoCorrigido.replace(/[.?]/g, '');
            textoCorrigido = textoCorrigido.replace(/\s+/g, ' ').trim();

            return textoCorrigido.toUpperCase();
        }
    </script>
    
</body>
</html>
