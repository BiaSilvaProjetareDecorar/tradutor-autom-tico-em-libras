<!DOCTYPE html>
<html>
<head>
    <title>Tradutor Automático de Áudio para Libras</title>
</head>
<body>

    <h1>Tradutor Instantâneo de Áudio para Libras</h1>
    <p>Clique em "Iniciar Microfone" para traduzir áudios ou vídeos. A tradução adaptada abrirá em uma nova aba.</p>

    <div id="saida-texto" style="border: 1px solid #ccc; padding: 10px; min-height: 50px; margin-bottom: 20px;">
        Clique em "Iniciar Microfone" para começar.
    </div>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/a006c000003Nf07/plugin.js" async defer></script>


    <button id="iniciar" style="font-size: 18px; padding: 10px; background-color: green; color: white;">Iniciar Microfone</button>
    <button id="parar" style="font-size: 18px; padding: 10px; background-color: red; color: white;" disabled>Parar</button>
    
    <script id="codigo-asr">
        const saidaTexto = document.getElementById('saida-texto');
        const iniciarBtn = document.getElementById('iniciar');
        const pararBtn = document.getElementById('parar');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (!SpeechRecognition) {
            saidaTexto.innerText = "ERRO: O seu navegador não suporta o Reconhecimento de Fala.";
            iniciarBtn.disabled = true;
        } else {
            const recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.interimResults = true;
            
            let finalTranscript = '';

            // Lógica ao receber um resultado de fala
            recognition.onresult = (event) => {
                let interimTranscript = '';
                finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                saidaTexto.innerText = `Original: ${finalTranscript + interimTranscript}`;
            };

            // Lógica ao terminar de capturar um bloco de fala
            recognition.onend = () => {
                iniciarBtn.style.backgroundColor = 'green';
                iniciarBtn.innerText = 'Iniciar Microfone';
                pararBtn.disabled = true;
                
                if (finalTranscript.trim().length > 0) {
                    // CHAMA A FUNÇÃO DE REGRAS E ADAPTAÇÃO
                    const textoCorrigido = aplicarRegrasDeLibras(finalTranscript.trim());
                    
                    saidaTexto.innerText = `Original: ${finalTranscript
